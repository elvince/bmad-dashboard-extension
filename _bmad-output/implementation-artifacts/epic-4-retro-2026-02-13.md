# Retrospective: Epic 4 - Workflow Actions

**Date:** 2026-02-13
**Epic Reviewed:** Epic 4 (Workflow Actions)
**Facilitator:** Bob (Scrum Master)
**Status:** Completed

---

## Epic Summary & Metrics

| Metric | Value |
|--------|-------|
| Total Stories | 4 |
| Stories Completed | 4 (100%) |
| Test Suite | 431 tests (328 Vitest + 103 Mocha) |
| Test Growth | +40 tests (from 391) |
| Blockers Encountered | 0 |
| Technical Debt Items | 0 new |
| Production Incidents | 0 |
| Security Findings | 1 (command injection prevention) |
| FR Coverage | FR12-FR15 (all 4 Workflow Actions FRs) |
| Total Project FR Coverage | 18 of 23 FRs (78%) |

### Per-Story Breakdown

| Story | Status | Type | Key Deliverables |
|-------|--------|------|------------------|
| 4-1: Workflow Discovery Service | done | Full implementation | WorkflowDiscoveryService, AvailableWorkflow type, StateManager integration, Zustand store support |
| 4-2: Context-Sensitive CTA Buttons | done | Full implementation | CTAButtons component, EXECUTE_WORKFLOW/COPY_COMMAND handlers, terminal execution, clipboard copy, bmad.cliPrefix setting |
| 4-3: Terminal Workflow Execution | done | Verification only | Verified existing implementation, added command injection validation regex |
| 4-4: Copy Command to Clipboard | done | Verification only | Verified existing implementation, improved test coverage |

### Test Growth Trajectory

```
Story 4.1: 399 tests (309 Vitest + 90 Mocha)
Story 4.2: 415 tests (321 Vitest + 94 Mocha)
Story 4.3: 427 tests (326 Vitest + 101 Mocha)
Story 4.4: 431 tests (328 Vitest + 103 Mocha)
```

---

## Team Participants

- Alice (Product Owner)
- Bob (Scrum Master) - Facilitator
- Charlie (Senior Dev)
- Dana (QA Engineer)
- Elena (Junior Dev)
- Winston (Architect)
- Boss (Project Lead)

---

## Successes & Strengths

### 1. Clean Execution — Zero Blockers, Zero Incidents

Epic 4 was the smoothest epic yet. No blockers encountered, no production incidents, no technical debt incurred. The patterns established in Epics 1-3 paid compound dividends — the team moved confidently through familiar architecture.

### 2. WorkflowDiscoveryService — Elegant Architecture

Story 4.1 created a clean service that computes available workflows as a pure function from DashboardState. It parallels the `get-next-action.ts` pattern from Epic 3 but returns ALL available workflows with an `isPrimary` flag. Installation detection filters against actually-installed workflows on disk. Smart, reusable design.

### 3. Security Catch in Code Review

Code review on Story 4.3 identified a command injection vulnerability — webview messages could inject arbitrary commands into the terminal via `terminal.sendText()`. A validation regex (`/^\/bmad-[a-z0-9-]+$/`) was added to guard against malicious inputs. Critical catch that prevented a real security hole.

### 4. Emergent Product Improvement — Configurable CLI Prefix

The `bmad.cliPrefix` VS Code setting wasn't in the original architecture but emerged during Story 4.2 implementation. It allows users to configure which CLI tool prefixes workflow commands (default: "claude"), making the extension work with any CLI tool (aider, copilot, etc.). Good product thinking during implementation.

### 5. Code Review Maturity

All 4 stories had code review with actionable findings. The nature of findings has evolved — no longer catching basic naming or pattern violations (those are internalized), now catching security vulnerabilities, performance concerns (useCallback), UX issues (cross-platform icon rendering), and test quality gaps. This represents real team growth.

### 6. Complete FR Delivery

All 4 Workflow Actions functional requirements delivered:
- FR12: One-click workflow launch via terminal
- FR13: Copy workflow command to clipboard
- FR14: Context-sensitive workflow options based on project state
- FR15: Determine available workflows based on state and installation

---

## Challenges & Growth Areas

### 1. Story Decomposition Too Granular

**Impact:** Stories 4.3 (Terminal Execution) and 4.4 (Copy to Clipboard) were verification-only — all their code was implemented in Story 4.2 (CTA Buttons).
**Root Cause:** The stories looked separable from a requirements perspective (discovery, UI, terminal, clipboard) but were coupled from an implementation perspective. The CTA button component naturally required both execute and copy handlers to be functional and testable.
**Lesson:** Stories sharing the same UI component tend to collapse in implementation. Before finalizing stories, check: "Do these stories modify the same file?" If yes, consider merging.

### 2. Previous Retro Action Items Not Followed Through

**Impact:** 3 of 5 action items from the Epics 1-3 retro were not addressed during Epic 4.
**Root Cause:** Retro action items have no tracking mechanism in the workflow. Stories have sprint-status tracking, code review gates, and clear "done" criteria. Action items sit in a markdown file with no visibility.
**Lesson:** Retro action items need to be tracked like any other work item. Add them to sprint-status or create stories for them.

**Specific items missed:**
- Architecture doc update (deferred twice — now critical)
- Tailwind v4 documentation
- Epic 5 library research (no longer needed since Epic 5 scope changed)

### 3. Epic Status Tracking Lag (Recurring)

**Impact:** Epic 4 shows "in-progress" in sprint-status.yaml despite all 4 stories being done. Same issue occurred with Epics 1-3 in the previous retro.
**Root Cause:** No automated mechanism to transition epic status. Manual process repeatedly forgotten.
**Lesson:** This is a recurring issue. Either automate it or make it a mandatory step in the last story's completion checklist.

---

## Key Insights & Learnings

1. **Coupled stories collapse.** When stories share a UI component, they tend to merge during implementation. The CTA button couldn't be shipped without its handlers. Check for shared files during story creation.

2. **Retro commitments need process support.** Writing action items in a retro doc isn't enough. Without tracking in the active workflow (sprint-status, story tasks), commitments get lost. This happened twice now.

3. **Code review is a security gate.** The command injection catch in Story 4.3 proves that code review isn't just about code quality — it's a security mechanism. Every story touching external inputs (webview messages, user configuration) should be reviewed with security in mind.

4. **Emergent design decisions can be valuable.** The configurable CLI prefix wasn't planned but improved the product. Teams should feel empowered to make small product improvements during implementation, as long as they're documented.

5. **Velocity is non-linear.** 2 of 4 stories required zero new code. This isn't waste — it's a sign that earlier stories were well-implemented. But it means story point estimates based on story count alone would be misleading.

---

## Previous Retrospective Follow-Through

### Action Items from Epics 1-3 Retro (2026-02-12)

| # | Action Item | Owner | Status | Evidence |
|---|-------------|-------|--------|----------|
| 1 | Update architecture doc to reflect actual implementation | Winston (Architect) | ❌ Not Addressed | Architecture doc still references obsolete template, npm, Tailwind 3 |
| 2 | Add accessibility checklist to code review process | Bob (Scrum Master) | ⏳ In Progress | Reviews catch accessibility issues organically but no formal checklist exists |
| 3 | Automate or document epic status transitions | Bob (Scrum Master) | ⏳ In Progress | Epics 1-3 updated manually, but Epic 4 has same issue. No automation. |
| 4 | Update epic statuses in sprint-status.yaml (1-3 → done) | Bob (Scrum Master) | ✅ Completed | Sprint-status shows Epics 1-3 as "done" |
| 5 | Document Tailwind v4 patterns for future stories | Charlie (Senior Dev) | ❌ Not Addressed | No documentation created |

### Preparation Tasks from Epics 1-3 Retro

| Task | Owner | Status |
|------|-------|--------|
| Update Epics 1, 2, 3 status to "done" | Bob (SM) | ✅ Completed |
| Update architecture doc with actual tech stack | Winston (Architect) | ❌ Not Addressed |
| Research react-markdown + mermaid + rehype-highlight for Epic 5 | Charlie (Senior Dev) | ❌ Not Addressed (no longer needed — Epic 5 scope changed) |
| Investigate automated epic status transitions | Bob (SM) | ❌ Not Addressed |

### Team Agreements Follow-Through

| Agreement | Status |
|-----------|--------|
| Continue co-locating tests with source files | ✅ All Epic 4 tests co-located |
| Continue code review for every story | ✅ All 4 stories reviewed |
| Use established component patterns | ✅ All patterns reused |
| Keep ParseResult<T> mandatory for parsing | ✅ WorkflowDiscoveryService follows pattern |

**Summary:** 1 of 5 action items completed, 2 in progress, 2 not addressed. Team agreements were fully followed. The gap is in action items that require proactive work outside the story flow.

---

## Next Epic Preview & Dependencies

### Epic 5: UX Polish & Dashboard Enhancements (NEW SCOPE)

**Original Epic 5 (Document Viewing) has been removed from the roadmap.** Boss redefined Epic 5 with the following scope:

1. **UX Detail Pass** — Story lists within epics, not just top-level epic display
2. **Kanban View** — Kanban board view in a specific editor viewer
3. **Help Icon** — "?" icon suggesting `bmad help`
4. **Actionable Next Action** — Add "play" icon to launch and "copy" icon to copy the next action command
5. **Actions Section** — Rename to show only "other actions" (primary moves to Next Action)
6. **Overflow Menu** — Replace standalone Refresh with "..." menu containing refresh, quick workflows, TEA (if installed)
7. **About Section** — BMAD version, last updated date, modules installed
8. **Epic List UX** — Show/hide toggle for done epics (default: hide), max 5 visible with scroll
9. **Keyboard Shortcut** — Change Shift+click to Ctrl/Cmd+click for raw .md file navigation
10. **Doc Tree View** — Planning Artifacts needs a document tree view

**Dependencies on Epic 4:**
- Workflow infrastructure (WorkflowDiscoveryService, CTA buttons, terminal execution) — all complete
- Message protocol and state management — established and proven

**Key Differences from Old Epic 5:**
- No new heavy libraries (react-markdown, mermaid, rehype-highlight no longer needed for MVP)
- Builds on proven dashboard patterns instead of introducing a second webview
- Exception: Kanban view may still require an editor panel webview

---

## Action Items

### Process Improvements

1. **Track retro action items in sprint-status.yaml**
   - Owner: Bob (Scrum Master)
   - Deadline: Before Epic 5 kickoff
   - Success criteria: Action items appear as trackable entries in sprint-status

2. **Improve story decomposition — check for shared UI surfaces**
   - Owner: Bob (Scrum Master)
   - Deadline: During Epic 5 story creation
   - Success criteria: No verification-only stories in Epic 5; stories touching same component are merged

### Technical Debt

1. **Update architecture doc to reflect actual implementation**
   - Owner: Charlie (Senior Dev)
   - Priority: High (deferred twice — mandatory)
   - Timing: In parallel with early Epic 5 stories
   - Description: Update to React 19, Vite 7, Tailwind 4 CSS-first, pnpm, lucide-react, bmad.cliPrefix setting, actual project structure. Remove obsolete starter template references.

2. **Update Epic 4 status to "done" in sprint-status.yaml**
   - Owner: Bob (Scrum Master)
   - Priority: High
   - Description: Epic 4 shows "in-progress" despite all stories done

### Documentation

1. **Update epics.md with new Epic 5 scope**
   - Owner: Alice (Product Owner)
   - Deadline: Before Epic 5 story creation
   - Description: Replace old Epic 5 (Document Viewing) with new UX Polish & Dashboard Enhancements scope

### Team Agreements

- Continue code review for every story — reviews catching security and architectural issues
- When a story absorbs adjacent scope, document it in dev notes and flag to SM for downstream re-scoping
- Retro action items are commitments, not suggestions — track them like work items

---

## Significant Discovery Analysis

**Epic Update Required: YES — Epic 5 Scope Redefined**

Epic 5 (Document Viewing) has been removed and replaced with a new scope focused on UX polish and dashboard enhancements. This is a strategic decision by Boss, not a failure of planning. The core extension value (project state visibility + workflow actions) is complete with Epics 1-4. The new Epic 5 polishes and extends the existing dashboard rather than adding a heavy new feature set.

**Impact:** The epics.md planning artifact needs to be updated to reflect the new Epic 5 definition before story creation can begin.

---

## Readiness Assessment

| Area | Status |
|------|--------|
| Testing & Quality | ✅ 431 tests passing, zero incidents |
| Story Completion | ✅ 4/4 stories done |
| Technical Health | ✅ Solid foundation, zero new debt |
| Unresolved Blockers | ✅ None |
| Epic 5 Readiness | ⚠️ New scope needs epics.md update and architecture doc update |

---

## Commitments & Next Steps

- **Action Items:** 5 (2 process, 2 tech debt, 1 documentation)
- **Team Agreements:** 3
- **Critical Path Items:** 2 (update epic status, update epics.md)

### Next Steps

1. **Update Epic 4 status to "done"** in sprint-status.yaml
2. **Update epics.md** with new Epic 5 scope (UX Polish & Dashboard Enhancements)
3. **Update architecture doc** (in parallel with early Epic 5 stories)
4. **Begin Epic 5 story creation** once epics.md is updated

---

## Team Performance Summary

Epic 4 delivered 4 stories with 100% completion, zero blockers, and zero production incidents. The team added 40 tests (391 → 431) and caught a critical security vulnerability in code review. Two stories were verification-only, revealing a story decomposition lesson for future epics. The retrospective surfaced 5 key insights and 1 significant discovery (Epic 5 scope redefinition). Previous retro follow-through was mixed (1/5 completed, 2/5 in progress, 2/5 missed), leading to a new commitment to track action items in sprint-status.

---

*Retrospective facilitated by Bob (Scrum Master) on 2026-02-13*
*Second project retrospective — builds on Epics 1-3 baseline*
